function carrito(){var goToCartIcon=function($addTocartBtn){var $cartIcon=$(".my-cart-icon");var $image=$('<img width="30px" height="30px" src="'+$addTocartBtn.data("image")+'"/>').css({position:"fixed","z-index":"999"});$addTocartBtn.prepend($image);var position=$cartIcon.position();$image.animate({top:position.top,left:position.left},500,"linear",function(){$image.remove()})};$('.my-cart-btn').off();$('.my-cart-btn').myCart({currencySymbol:'$',classCartIcon:'my-cart-icon',classCartBadge:'my-cart-badge',classProductQuantity:'my-product-quantity',classProductRemove:'my-product-remove',classCheckoutCart:'my-cart-checkout',affixCartIcon:true,showCheckoutModal:true,cartItems:[],clickOnAddToCart:function($addTocart){goToCartIcon($addTocart)},afterAddOnCart:function(products,totalPrice,totalQuantity){console.log("afterAddOnCart",products,totalPrice,totalQuantity);},clickOnCartIcon:function($cartIcon,products,totalPrice,totalQuantity){console.log("cart icon clicked",$cartIcon,products,totalPrice,totalQuantity)},checkoutCart:function(products,totalPrice,totalQuantity){var checkoutString="Total Price: "+totalPrice+"\nTotal Quantity: "+totalQuantity;checkoutString+="\n\n id \t name \t summary \t price \t quantity \t image path";$.each(products,function(){checkoutString+=("\n "+this.id+" \t "+this.name+" \t "+this.summary+" \t "+this.price+" \t "+this.quantity+" \t "+this.image)});$('head').append('<link rel="stylesheet" href="/assets/css/sections/sectionCheckout.css" />');$.post('/checkout/confirm.php',{products:products,totalPrice:totalPrice}).success(function(html){$('#main').html(html)}).error(function(){alert('ERROR')});console.log("checking out",products,totalPrice,totalQuantity)},getDiscountPrice:function(products,totalPrice,totalQuantity){const cantPromo=5;let finalPrice=totalPrice;let unityPrice=totalPrice/totalQuantity;if(totalQuantity>=cantPromo){finalPrice=Math.round(Math.floor(totalQuantity/cantPromo)*unityPrice/1.2*cantPromo+(totalQuantity%cantPromo)*unityPrice);return finalPrice}else{return null}}});}let $pathname=location.pathname;let $section='';let $json='';let $template='';$('body').append('<script id="pictures-template" type="text/x-handlebars-template"></script>');$section=$pathname.includes('/eventos/')?'eventos':($pathname.includes('/inicio/')?'inicio':($pathname.includes('/galeria/')?'galeria':''));if(!$pathname.includes('/agenda')){$template=$section=='eventos'?'eventos':$section;$('#pictures-template').load('/assets/includes/'+$template+'Template.htm',function(){$(document).ready(function(){let raw_template=$('#pictures-template').html();let template=Handlebars.compile(raw_template);let events_placeholder=$("#gallery-wrapper");let title_placeholder=$("#gallery_title");let ads_placeHolder=$("#gallery-ad");let galleries=getGET();$json=$section=='eventos'?galleries.g:$section;if($section=='galeria'||$section=='inicio'){Handlebars.registerHelper('full_href',function(picture){return '/eventos/?g='+picture.ID});}$.get("/assets/datasources/"+$json+".json",function(data,status,xhr){let IdEvento=location.hostname=='localhost'?JSON.parse(data).IdEvento:data.IdEvento;let title=location.hostname=='localhost'?JSON.parse(data).title:data.title;let price=location.hostname=='localhost'?JSON.parse(data).price:data.price;let json_data=location.hostname=='localhost'?JSON.parse(data):data;let html_element='';let pics_length=location.hostname=='localhost'?JSON.parse(data).pictures.length:data.pictures.length;let index=0;let $page_start=0;let $page_limit=9;let=lastItem=0;var load_page=function(placeholder,page_start,page_limit,data){placeholder.append($('.loading').detach());$('.loading').fadeIn("fast");let pic='';let title=data.title;let price=data.price;var i=0;for(i=page_start;i<page_start+page_limit;i+=1){pic=data.pictures[i];html_element='<div class="media">  <a href=#'+data.IdEvento+'_'+pic+' class="open-popup-link" > <img style="background:url(/assets/images/loading.gif) transparent no-repeat" src=/assets/images/eventos/'+data.IdEvento+'/thumbs/'+pic+'.jpg alt="" title="" /> </a> <div class="cart_btns"> <button class="btn btn-danger my-cart-btn" data-id='+pic+' data-name="['+title+' ] foto '+pic+'" data-summary=foto_'+pic+' data-price="'+data.price+'" data-quantity="1" data-image=/assets/images/eventos/'+data.IdEvento+'/thumbs/'+pic+'.jpg >Agregar al carrito</button> </div> <div id='+data.IdEvento+'_'+pic+' class="white-popup mfp-hide"> <div class="button-group"> <a class="fb-xfbml-parse-ignore btn btn-facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://acciondigital.000webhostapp.com/individual/?g='+data.IdEvento+'+p='+pic+'"> <i class="fa fa-facebook-square"> </i>Compartir</a> <div class="cart_btns"> <button class="btn btn-danger my-cart-btn" data-id='+pic+' data-name="['+title+' ] foto '+pic+'" data-summary=foto_'+pic+' data-price="'+data.price+'" data-quantity="1" data-image=/assets/images/eventos/'+data.IdEvento+'/thumbs/'+pic+'.jpg >Agregar al carrito</button> </div> </div> <div class="img-wrapper"> <img src=/assets/images/eventos/'+data.IdEvento+'/'+pic+'.jpg alt="" title="" /> </div> </div> </div>';placeholder.append(html_element);}lastItem=data.IdEvento+'_'+pic;function loading(){setTimeout(function(){console.log('***intento ');if($('.media a[href="#'+data.IdEvento+'_'+data.pictures[page_start]+'"] img')[0].complete){$('.loading').fadeOut("fast");}else{console.log('***nones ');loading()}},500)}loading();carrito();$('.open-popup-link').magnificPopup({gallery:{enabled:true,preload:1}})};$('.mfp-arrow-right').on('click',function(event){event.preventDefault();console.log('***click');let actual_pic=$(this).parent().find('.white-popup').attr('id');if(actual_pic==lastItem){alert('es')}});load_page(events_placeholder,$page_start,$page_limit,json_data);$page_start+=$page_limit;let $pagina=1;$(window).on('scroll',_.debounce(function(){if($page_start+$page_limit<=pics_length&&$page_limit!=0&&!$('#gallery-wrapper').hasClass('results')){if(($(window).outerHeight(true)+$(window).scrollTop())>($('#gallery-wrapper').height()-200)){load_page(events_placeholder,$page_start,$page_limit,json_data);$page_start+=$page_limit;$page_limit=($page_start+$page_limit>pics_length)?(pics_length-$page_start):$page_limit}}},200));$('.events-page').on('click','.mfp-arrow-right',function(event){event.preventDefault();console.log('***click');let actual_pic=$(this).parent().find('.white-popup').attr('id');if(actual_pic==lastItem){load_page(events_placeholder,$page_start,$page_limit,json_data);$('.open-popup-link').magnificPopup({gallery:{enabled:true,preload:1}})}});let html_ads='<div id="gallery-ad" id="gallery-ad"> {{#ads}} <a href={{this.href}} target="_blank"> <img src=/assets/images/ads/{{this.name}} alt="" /> </a> {{/ads}} </div>';var load_ads=function(placeholder,data){if(data.ads){let ad='';for(var i=0;i<data.ads.length;i+=1){ad=data.ads[i];html_ads='<a href='+ad.href+' target="_blank"> <img src=/assets/images/ads/'+ad.name+' alt="" /> </a>';placeholder.append(html_ads)}}};load_ads(ads_placeHolder,json_data);title_placeholder.append(title);carrito();$('.open-popup-link').magnificPopup({gallery:{enabled:true,preload:1}})})})})}function getCurrentScroll(){return window.pageYOffset||document.documentElement.scrollTop}const shrinkHeader=100;$(function(){$(window).scroll(function(){let scroll=getCurrentScroll();if(scroll>=shrinkHeader){$('#header').addClass('shrink');$('#btnTop').show('400')}else{$('#header').removeClass('shrink');$('#btnTop').hide('400')}})});$(document).ready(function(){$('body').append('<div id="btnTop"><span class="fa fa-angle-up "></span></div>');if(getCurrentScroll()<=shrinkHeader){$('#btnTop').hide()}$('#btnTop').click(function(){$('html,body').animate({scrollTop:0},400);return false})});function getGET(){let loc=document.location.href;if(loc.indexOf('?')>0){let getString=loc.split('?')[1];let GET=getString.split('&');let get={};for(let i=0,l=GET.length;i<l;i+=1){let tmp=GET[i].split('=');get[tmp[0]]=unescape(decodeURI(tmp[1])).indexOf('#')!=-1?unescape(decodeURI(tmp[1])).substr(0,unescape(decodeURI(tmp[1])).indexOf('#')):unescape(decodeURI(tmp[1]))}return get}}$(function(){let $param=location.pathname;switch($param){case '/index.html':$('#nav-header ul li.home').addClass('active');break;case '/galeria/':$('#nav-header ul li.gallery').addClass('active');break;case '/agenda/':$('#nav-header ul li.calendar').addClass('active');break;case '/eventos/':$('#nav-header ul li.gallery').addClass('active');break;case '/contacto/':$('#nav-header ul li.contact').addClass('active');break;default:$('#nav-header ul li.home').addClass('active')}carrito()});$(function(){let $param=location.pathname;if($param!='/index.html'||$param!='/inicio/'){$('#nav-header ul li.toggle_search').removeClass('hidden')}$('.toggle_search').on('click',function(event){event.preventDefault();$('#nav-header ul').toggleClass('shown').toggleClass('hidden');$('#nav-header .buscador').toggleClass('hidden').toggleClass('shown')})});$(function(){$('#untagged').on('click',function(event){event.preventDefault();console.log('***toca boton');buscar('untagged')})});function buscar(foto){let galleries=getGET();$.get("/assets/datasources/"+galleries.g+".json",function(data,status,xhr){let html=location.hostname=='localhost'?JSON.parse(data):data;let arrFiltro=[];let sinCodigo=[];let title=html.title;let price=html.price;let codigo='';html.pictures.forEach(function(el,index){if(el.indexOf('-')==-1){sinCodigo.push(el)}else{codigo=el.substr(el.indexOf('-')+1,el.length);if(codigo.split('-').length>1){codigo.split('-').forEach(function(element,i){if(element==foto){arrFiltro.push(el)}})}else if(codigo==foto){arrFiltro.push(el);}}});var load_page=function(placeholder,page_start,page_limit,data){let pic='';for(var i=page_start;i<page_start+page_limit;i+=1){pic=data[i];html_element='<div class="media"><a href=#'+galleries.g+'_'+pic+' class="open-popup-link" > <img style="background:url(/assets/images/loading.gif) transparent no-scroll" src=/assets/images/eventos/'+galleries.g+'/thumbs/'+pic+'.jpg alt="" title="" /> </a> <div class="cart_btns"><button class="btn btn-danger my-cart-btn" data-id='+pic+' data-name="['+title+' ] foto '+pic+'" data-summary=foto_'+pic+' data-price="'+price+'" data-quantity="1" data-image=/assets/images/eventos/'+galleries.g+'/thumbs/'+pic+'.jpg >Agregar al carrito</button> </div> <div id='+galleries.g+'_'+pic+' class="white-popup mfp-hide"> <div class="button-group"> <a class="fb-xfbml-parse-ignore btn btn-facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://acciondigitalfoto.com/assets/images/eventos/'+galleries.g+'/'+pic+'.jpg"><i class="fa fa-facebook-square"></i>Compartir</a> <div class="cart_btns"><button class="btn btn-danger my-cart-btn" data-id='+pic+' data-name="['+title+' ] foto '+pic+'" data-summary=foto_'+pic+' data-price="'+price+'" data-quantity="1" data-image=/assets/images/eventos/'+galleries.g+'/thumbs/'+pic+'.jpg >Agregar al carrito</button> </div> </div> <div class="img-wrapper"> <img src=/assets/images/eventos/'+galleries.g+'/'+pic+'.jpg alt="" title="" /> </div> </div> </div>';$('#results').append(html_element)}carrito();$('.open-popup-link').magnificPopup({gallery:{enabled:true,preload:1}})};if(arrFiltro.length!=0){let $results='<h3>Resultado de la búsqueda "'+foto+'": '+arrFiltro.length+(arrFiltro.length>1?' fotos':' foto')+'</h3><p>Además de éstas, puede haber fotos tuyas sin clasificar.</p><div id="results"></div>';let events_placeholder=$('#results');$('#gallery-wrapper').addClass('results').html($results);let IdEvento=html.IdEvento;let title=html.title;let json_arrFiltro=arrFiltro;let html_element='';let pics_length=arrFiltro.length;let index=0;let $page_start=0;let $page_limit=9;$page_limit=($page_limit>pics_length)?pics_length:$page_limit;load_page(events_placeholder,$page_start,$page_limit,arrFiltro);$page_start+=$page_limit;let $pagina=1;$(window).scroll(function(){if($page_start+$page_limit<=pics_length&&$page_limit!=0){if(($(window).outerHeight(true)+$(window).scrollTop())>($(document).height()-300)){load_page(events_placeholder,$page_start,$page_limit,arrFiltro);$page_start+=$page_limit;$page_limit=($page_start+$page_limit>pics_length)?(pics_length-$page_start):$page_limit}}});}else{if(foto!='untagged'){console.log('***no hay');var $results='<h3>Tu búsqueda "'+foto+'" no produjo resultados.</h3><h4>Las siguientes fotos no tienen código asignado:</h4><div id="results"></div>'}else{console.log('***no busco');var $results='<h4>Las siguientes fotos no tienen código asignado:</h4><div id="results"></div>'}let events_placeholder=$('#results');$('#gallery-wrapper').addClass('results').html($results);let IdEvento=html.IdEvento;let title=html.title;let json_sinCodigo=sinCodigo;let html_element='';let pics_length=sinCodigo.length;let index=0;let $page_start=0;let $page_limit=9;$page_limit=($page_limit>pics_length)?pics_length:$page_limit;load_page(events_placeholder,$page_start,$page_limit,sinCodigo);$page_start+=$page_limit;let $pagina=1;$(window).scroll(function(){if($page_start+$page_limit<=pics_length&&$page_limit!=0){if(($(window).outerHeight(true)+$(window).scrollTop())>($(document).height()-300)){load_page(events_placeholder,$page_start,$page_limit,sinCodigo);$page_start+=$page_limit;$page_limit=($page_start+$page_limit>pics_length)?(pics_length-$page_start):$page_limit}}});}carrito();$('.open-popup-link').magnificPopup({gallery:{enabled:true,preload:1}})})}$('form').placeholder();$('.scrolly').scrolly();